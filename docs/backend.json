{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the SaaS Pilot application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "role": {
          "type": "string",
          "description": "The role of the user, e.g., 'admin' or 'member'.",
          "enum": [
            "admin",
            "member"
          ]
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the user was last updated.",
          "format": "date-time"
        },
        "onboardingCompleted": {
          "type": "boolean",
          "description": "Flag to indicate if the user has completed the onboarding flow."
        },
        "workspaceName": {
          "type": "string",
          "description": "The name of the user's workspace, collected during onboarding."
        },
        "intent": {
          "type": "string",
          "description": "The user's primary goal or role, collected during onboarding for personalization.",
          "enum": [
            "Founder",
            "Developer",
            "Product Manager",
            "Team Member"
          ]
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "SubscriptionPlan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SubscriptionPlan",
      "type": "object",
      "description": "Represents a subscription plan offered by the SaaS application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the subscription plan."
        },
        "name": {
          "type": "string",
          "description": "Name of the subscription plan (e.g., Basic, Premium)."
        },
        "price": {
          "type": "number",
          "description": "Price of the subscription plan."
        },
        "features": {
          "type": "array",
          "description": "List of features included in the plan.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "price",
        "features"
      ]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Represents a user's subscription to a specific plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the subscription."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User entity. (Relationship: User 1:N Subscription)"
        },
        "subscriptionPlanId": {
          "type": "string",
          "description": "Reference to the SubscriptionPlan entity. (Relationship: SubscriptionPlan 1:N Subscription)"
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the subscription.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the subscription.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the subscription (e.g., Active, Cancelled)."
        }
      },
      "required": [
        "id",
        "userId",
        "subscriptionPlanId",
        "startDate",
        "endDate",
        "status"
      ]
    },
    "DashboardLayout": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "DashboardLayout",
      "type": "object",
      "description": "Represents a user's custom dashboard layout.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the dashboard layout."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User entity. (Relationship: User 1:N DashboardLayout)"
        },
        "layoutData": {
          "type": "string",
          "description": "JSON string representing the dashboard layout configuration."
        }
      },
      "required": [
        "id",
        "userId",
        "layoutData"
      ]
    },
    "Template": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Template",
      "type": "object",
      "description": "Represents a generated template.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the template."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User entity. (Relationship: User 1:N Template)"
        },
        "prompt": {
          "type": "string",
          "description": "The prompt used to generate the template."
        },
        "content": {
          "type": "string",
          "description": "The content of the generated template."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the template was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "prompt",
        "content",
        "createdAt"
      ]
    },
    "Role": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Role",
      "type": "object",
      "description": "Represents a user role.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the role."
        },
        "name": {
          "type": "string",
          "description": "Name of the role (e.g., Admin, Editor, Viewer)."
        },
        "permissions": {
          "type": "array",
          "description": "List of permissions associated with the role.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "permissions"
      ]
    },
    "UserRole": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserRole",
      "type": "object",
      "description": "Represents the association between a user and a role.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user role assignment."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User entity. (Relationship: User 1:N UserRole)"
        },
        "roleId": {
          "type": "string",
          "description": "Reference to the Role entity. (Relationship: Role 1:N UserRole)"
        }
      },
      "required": [
        "id",
        "userId",
        "roleId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Path-based ownership ensures only the user can access their profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/subscriptions/{subscriptionId}",
        "definition": {
          "entityName": "Subscription",
          "schema": {
            "$ref": "#/backend/entities/Subscription"
          },
          "description": "Stores user subscriptions. Path-based ownership ensures only the user can access their subscriptions.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "subscriptionId",
              "description": "The unique identifier of the subscription."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/dashboardLayouts/{dashboardLayoutId}",
        "definition": {
          "entityName": "DashboardLayout",
          "schema": {
            "$ref": "#/backend/entities/DashboardLayout"
          },
          "description": "Stores user dashboard layouts. Path-based ownership ensures only the user can access their layouts.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "dashboardLayoutId",
              "description": "The unique identifier of the dashboard layout."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/templates/{templateId}",
        "definition": {
          "entityName": "Template",
          "schema": {
            "$ref": "#/backend/entities/Template"
          },
          "description": "Stores user templates. Path-based ownership ensures only the user can access their templates.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "templateId",
              "description": "The unique identifier of the template."
            }
          ]
        }
      },
      {
        "path": "/subscriptionPlans/{subscriptionPlanId}",
        "definition": {
          "entityName": "SubscriptionPlan",
          "schema": {
            "$ref": "#/backend/entities/SubscriptionPlan"
          },
          "description": "Stores subscription plans.  No ownership required.",
          "params": [
            {
              "name": "subscriptionPlanId",
              "description": "The unique identifier of the subscription plan."
            }
          ]
        }
      },
      {
        "path": "/userRoles/{userRoleId}",
        "definition": {
          "entityName": "UserRole",
          "schema": {
            "$ref": "#/backend/entities/UserRole"
          },
          "description": "Stores user roles. Roles are managed globally by admins.",
          "params": [
            {
              "name": "userRoleId",
              "description": "The unique identifier of the user role."
            }
          ]
        }
      },
      {
        "path": "/roles/{roleId}",
        "definition": {
          "entityName": "Role",
          "schema": {
            "$ref": "#/backend/entities/Role"
          },
          "description": "Stores available roles in the system.",
          "params": [
            {
              "name": "roleId",
              "description": "The unique identifier of the role."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure security, scalability, and ease of debugging, following the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). Authorization Independence is achieved through denormalization. For example, access to Templates depends on the user. The `userId` is duplicated within the Template documents so that rules do not need to `get()` parent user documents to check ownership. This ensures atomic operations and simplifies security rules. Structural Segregation is used to ensure that each collection has a homogeneous security posture. For instance, user-specific data (templates, dashboard layouts) are stored in user-owned subcollections.  Access Modeling utilizes path-based ownership for private user data (`/users/{userId}/templates/{templateId}`). Membership Maps are not required in this data model, as there is no collaborative data.\n\nThe structure also facilitates QAPs by structuring data such that list operations can be securely filtered based on path-based ownership."
  }
}
